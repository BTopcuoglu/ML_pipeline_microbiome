<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Managing mikropml Workflows with Snakemake • mikropml</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Managing mikropml Workflows with Snakemake">
<meta property="og:description" content="mikropml">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mikropml</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SchlossLab/mikropml/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Managing mikropml Workflows with Snakemake</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SchlossLab/mikropml/blob/master/vignettes/snakemake.Rmd"><code>vignettes/snakemake.Rmd</code></a></small>
      <div class="hidden name"><code>snakemake.Rmd</code></div>

    </div>

    
    
<p>Snakemake is… TODO</p>
<div id="the-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#the-workflow" class="anchor"></a>The Workflow</h2>
<p>The <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/Snakefile"><code>Snakefile</code></a> contains rules which define the output files we want and how to make them. Snakemake automatically figures out the dependencies of each of the rules and what order to run them in.</p>
<p>This Snakemake workflow preprocesses the dataset (<a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/data/otu_large.csv"><code>data/otu_large.csv</code></a>) with <code><a href="../reference/preprocess_data.html">mikropml::preprocess_data()</a></code>, calls <code><a href="../reference/run_ml.html">mikropml::run_ml()</a></code> for each seed and ML method set in <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/config/config.yml"><code>config/config.yml</code></a>, combines the results files, plots performance results, and renders a simple <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/Snakefile/report.Rmd">R Markdown report</a> as a GitHub-flavored <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/report.md">markdown file</a>.</p>
<p><img src="https://raw.githubusercontent.com/SchlossLab/mikropml-snakemake-workflow/master/figures/rulegraph.png"></p>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<ol style="list-style-type: decimal">
<li>
<p>Clone or download the <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow">mikropml-snakemake-workflow</a> repo.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">git</span> clone https://github.com/SchlossLab/mikropml-snakemake-workflow</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="bu">cd</span> mikropml-snakemake-workflow</a></code></pre></div>
</li>
<li>
<p>Install snakemake.</p>
<p>We recommend using conda (see <a href="https://docs.conda.io/en/latest/miniconda.html">miniconda installation here</a>) to install Snakemake and its dependencies. Create a conda environment and activate it with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">conda</span> env create -f config/environment.yml</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ex">conda</span> activate smk-ML</a></code></pre></div>
<p>Alternatively, you can <a href="https://snakemake.readthedocs.io/en/stable/getting_started/installation.html">install snakemake</a> and the other dependencies listed in <code>config/environment.yml</code> however you like.</p>
</li>
<li>
<p>Install the mikropml R package: see the <a href="https://github.com/SchlossLab/mikropml#installation">mikropml install instructions</a>.</p>
<p>e.g.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">R</span> -e <span class="st">'devtools::install_github("SchlossLab/mikropml")'</span></a></code></pre></div>
</li>
<li>
<p>Edit the configuration file <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/config/config.yml"><code>config/config.yml</code></a>.</p>
<ul>
<li>
<code>ml_methods</code>: list of machine learning methods to use. Must be supported by mikropml.</li>
<li>
<code>ncores</code>: the number of cores to use for preprocessing and for each <code><a href="../reference/run_ml.html">mikropml::run_ml()</a></code> call. Do not exceed the number of cores you have available.</li>
<li>
<code>nseeds</code>: the number of different random seeds to use for training models with <code><a href="../reference/run_ml.html">mikropml::run_ml()</a></code>.</li>
</ul>
</li>
<li>
<p>Do a dry run to make sure the snakemake workflow is valid.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">snakemake</span> -n</a></code></pre></div>
</li>
<li>
<p>Run the workflow.</p>
<p>Run it locally with:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">snakemake</span></a></code></pre></div>
<p>To run the workflow on an HPC with SLURM:</p>
<ol style="list-style-type: decimal">
<li>Edit your email (<code>YOUR_EMAIL_HERE</code>) and SLURM account (<code>YOUR_ACCOUNT_HERE</code>) in:
<ul>
<li><a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/code/submit_slurm.sh"><code>code/submit_slurm.sh</code></a></li>
<li><a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/config/cluster.json"><code>config/cluster.json</code></a></li>
</ul>
</li>
<li>Submit the snakemake workflow with: <code>µsh  sbatch code/submit_slurm.sh</code> The main job will then submit other snakemake jobs.</li>
</ol>
</li>
<li><p>View the results in <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/blob/master/report.md"><code>report.md</code></a>.</p></li>
</ol>
</div>
<div id="resources" class="section level2">
<h2 class="hasAnchor">
<a href="#resources" class="anchor"></a>Resources</h2>
<ul>
<li><a href="https://snakemake.readthedocs.io/en/stable">Snakemake docs</a></li>
<li><a href="http://www.schlosslab.org/mikropml/">mikropml docs</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/BTopcuoglu">Begüm Topçuoğlu</a>, <a href="https://github.com/pschloss">Patrick Schloss</a>, <a href="https://github.com/zenalapp">Zena Lapp</a>, <a href="https://github.com/kelly-sovacool">Kelly Sovacool</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
