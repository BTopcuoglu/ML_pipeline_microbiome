<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to mikropml • mikropml</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to mikropml">
<meta property="og:description" content="mikropml">
<meta property="og:image" content="http://www.schlosslab.org/mikropml/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mikropml</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Paper</li>
    <li>
      <a href="../articles/paper.html">mikropml: User-Friendly R Package for Supervised Machine Learning Pipelines</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Vignettes</li>
    <li>
      <a href="../articles/introduction.html">Introduction to mikropml</a>
    </li>
    <li>
      <a href="../articles/preprocess.html">Preprocessing data</a>
    </li>
    <li>
      <a href="../articles/tuning.html">Hyperparameter tuning</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel processing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SchlossLab/mikropml/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to mikropml</h1>
                        <h4 data-toc-skip class="author">Zena Lapp</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SchlossLab/mikropml/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>The goal of <code>mikropml</code> is to make supervised machine learning (ML) easy for you to run while implementing good practices for machine learning pipelines. All you need to run the ML pipeline is one function: <code><a href="../reference/run_ml.html">run_ml()</a></code>. We’ve selected sensible default arguments related to good practices <span class="citation">(Topçuoğlu et al. 2020; Tang et al. 2020)</span>, but we allow you to change those arguments to tailor <code><a href="../reference/run_ml.html">run_ml()</a></code> to the needs of your data.</p>
<p>This document takes you through all of the <code><a href="../reference/run_ml.html">run_ml()</a></code> inputs, both required and optional, as well as the outputs.</p>
<p>In summary, you provide:</p>
<ul>
<li>A dataset with an outcome column and feature columns (rows are samples; unfortunately we do not support multi-label classification)</li>
<li>Model choice (i.e. method)</li>
</ul>
<p>And the function outputs:</p>
<ul>
<li>The trained model</li>
<li>Model performance metrics</li>
<li>(Optional) feature importance metrics</li>
</ul>
<div class="section level2">
<h2 id="its-running-so-slow">It’s running so slow!<a class="anchor" aria-label="anchor" href="#its-running-so-slow"></a>
</h2>
<p>Since I assume a lot of you won’t read this entire vignette, I’m going to say this at the beginning. If the <code><a href="../reference/run_ml.html">run_ml()</a></code> function is running super slow, you should consider parallelizing. See <code><a href="../articles/parallel.html">vignette("parallel")</a></code> for examples.</p>
</div>
<div class="section level2">
<h2 id="understanding-the-inputs">Understanding the inputs<a class="anchor" aria-label="anchor" href="#understanding-the-inputs"></a>
</h2>
<div class="section level3">
<h3 id="the-input-data">The input data<a class="anchor" aria-label="anchor" href="#the-input-data"></a>
</h3>
<p>The input data to <code><a href="../reference/run_ml.html">run_ml()</a></code> is a dataframe where each row is a sample or observation. One column (assumed to be the first) is the outcome of interest, and all of the other columns are the features. We package <code>otu_mini_bin</code> as a small example dataset with <code>mikropml</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("devtools")</span>
<span class="co">#devtools::install_github("SchlossLab/mikropml")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.schlosslab.org/mikropml/" class="external-link">mikropml</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">otu_mini_bin</span><span class="op">)</span>
<span class="co">#&gt;       dx Otu00001 Otu00002 Otu00003 Otu00004 Otu00005 Otu00006 Otu00007</span>
<span class="co">#&gt; 1 normal      350      268      213        1      208      230       70</span>
<span class="co">#&gt; 2 normal      568     1320       13      293      671      103       48</span>
<span class="co">#&gt; 3 normal      151      756      802      556      145      271       57</span>
<span class="co">#&gt; 4 normal      299       30     1018        0       25       99       75</span>
<span class="co">#&gt; 5 normal     1409      174        0        3        2     1136      296</span>
<span class="co">#&gt; 6 normal      167      712      213        4      332      534      139</span>
<span class="co">#&gt;   Otu00008 Otu00009 Otu00010</span>
<span class="co">#&gt; 1      230      235       64</span>
<span class="co">#&gt; 2      204      119      115</span>
<span class="co">#&gt; 3      176       37      710</span>
<span class="co">#&gt; 4       78      255      197</span>
<span class="co">#&gt; 5        1      537      533</span>
<span class="co">#&gt; 6      251      155      122</span></code></pre></div>
<p>Here, <code>dx</code> is the outcome column (normal or cancer), and there are 10 features (<code>Otu00001</code> through <code>Otu00010</code>). Because there are only 2 outcomes, we will be performing binary classification in the majority of the examples below. At the bottom, we will also briefly provide examples of multi-class and continuous outcomes. As you’ll see, you run them in the same way as for binary classification!</p>
<p>The feature columns are the amount of each <a href="https://en.wikipedia.org/wiki/Operational_taxonomic_unit" class="external-link">Operational Taxonomic Unit (OTU)</a> in microbiome samples from patients with cancer and without cancer. The goal is to predict <code>dx</code>, which stands for diagnosis. This diagnosis can be cancer or not based on an individual’s microbiome. No need to understand exactly what that means, but if you’re interested you can read more about it from the original paper <span class="citation">(Topçuoğlu et al. 2020)</span>.</p>
<p>For real machine learning applications you’ll need to use more features, but for the purposes of this vignette we’ll stick with this example dataset so everything runs faster.</p>
</div>
<div class="section level3">
<h3 id="the-methods-we-support">The methods we support<a class="anchor" aria-label="anchor" href="#the-methods-we-support"></a>
</h3>
<p>All of the methods we use are supported by a great ML wrapper package <a href="https://topepo.github.io/caret/" class="external-link"><code>caret</code></a>, which we use to train our machine learning models.</p>
<p>The methods we have tested (and their backend packages) are:</p>
<ul>
<li>Logistic/multiclass/linear regression (<code>"glmnet"</code>)</li>
<li>Random forest (<code>"rf"</code>)</li>
<li>Decision tree (<code>"rpart2"</code>)</li>
<li>Support vector machine with a radial basis kernel (<code>"svmRadial"</code>)</li>
<li>xgboost (<code>"xgbTree"</code>)</li>
</ul>
<p>For documentation on these methods, as well as many others, you can look at the <a href="https://topepo.github.io/caret/available-models.html" class="external-link">available models</a> (or see <a href="https://topepo.github.io/caret/train-models-by-tag.html" class="external-link">here</a> for a list by tag). While we have not vetted the other models used by <code>caret</code>, our function is general enough that others might work. While we can’t promise that we can help with other models, feel free to <a href="https://github.com/SchlossLab/mikropml/issues" class="external-link">open an issue on GitHub</a> if you have questions about other models and we <em>might</em> be able to help.</p>
<p>We will first focus on <code>glmnet</code>, which is our default implementation of L2-regularized logistic regression. Then we will cover a few other examples towards the end.</p>
</div>
</div>
<div class="section level2">
<h2 id="before-running-ml">Before running ML<a class="anchor" aria-label="anchor" href="#before-running-ml"></a>
</h2>
<p>Before you execute <code><a href="../reference/run_ml.html">run_ml()</a></code>, you should consider preprocessing your data, either on your own or with the <code><a href="../reference/preprocess_data.html">preprocess_data()</a></code> function. You can learn more about this in the preprocessing vignette: <code><a href="../articles/preprocess.html">vignette("preprocess")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="the-simplest-way-to-run_ml">The simplest way to <code>run_ml()</code><a class="anchor" aria-label="anchor" href="#the-simplest-way-to-run_ml"></a>
</h2>
<p>As mentioned above, the minimal input is your dataset (<code>dataset</code>) and the machine learning model you want to use (<code>method</code>).</p>
<p>You may also want to provide:</p>
<ul>
<li>The outcome column name. By default <code><a href="../reference/run_ml.html">run_ml()</a></code> will pick the first column, but it’s best practice to specify the column name explicitly.</li>
<li>A seed so that the results will be reproducible, and so that you get the same results as those you see here (i.e have the same train/test split).</li>
</ul>
<p>Say we want to use logistic regression, then the method we will use is <code>glmnet</code>. To do so, run the ML pipeline with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                  <span class="st">'glmnet'</span>,
                  outcome_colname <span class="op">=</span> <span class="st">'dx'</span>,
                  seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span></code></pre></div>
<p>You’ll notice a few things:</p>
<ol style="list-style-type: decimal">
<li>It takes a little while to run. This is because of some of the parameters we use.</li>
<li>There is a message stating that ‘dx’ is being used as the outcome column. This is what we want, but it’s a nice sanity check!</li>
<li>There was a warning. Don’t worry about this warning right now - it just means that some of the hyperparameters aren’t a good fit - but if you’re interested in learning more, see <code><a href="../articles/tuning.html">vignette("tuning")</a></code>.</li>
</ol>
<p>Now, let’s dig into the output a bit. The results is a list of 4 things:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span>
<span class="co">#&gt; [1] "trained_model"      "test_data"          "performance"       </span>
<span class="co">#&gt; [4] "feature_importance"</span></code></pre></div>
<p><code>trained_model</code> is the trained model from <code>caret</code>. There is a bunch of info in this that we won’t get into, because you can learn more from the <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code> documentation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">trained_model</span><span class="op">)</span>
<span class="co">#&gt;  [1] "method"       "modelInfo"    "modelType"    "results"      "pred"        </span>
<span class="co">#&gt;  [6] "bestTune"     "call"         "dots"         "metric"       "control"     </span>
<span class="co">#&gt; [11] "finalModel"   "preProcess"   "trainingData" "resample"     "resampledCM" </span>
<span class="co">#&gt; [16] "perfNames"    "maximize"     "yLimits"      "times"        "levels"      </span>
<span class="co">#&gt; [21] "terms"        "coefnames"    "xlevels"</span></code></pre></div>
<p><code>test_data</code> is the partition of the dataset that was used for testing. In machine learning, it’s always important to have a held-out test dataset that is not used in the training stage. In this pipeline we do that using <code><a href="../reference/run_ml.html">run_ml()</a></code> where we split your data into training and testing sets. The training data are used to build the model (e.g. tune hyperparameters, learn the data) and the test data are used to evaluate how well the model performs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">test_data</span><span class="op">)</span>
<span class="co">#&gt;        dx Otu00009 Otu00005 Otu00010 Otu00001 Otu00008 Otu00004 Otu00003</span>
<span class="co">#&gt; 9  normal      119      142      248      256      363      112      871</span>
<span class="co">#&gt; 14 normal       60      209       70       86       96        1      123</span>
<span class="co">#&gt; 16 cancer      205        5      180     1668       95       22        3</span>
<span class="co">#&gt; 17 normal      188      356      107      381     1035      915      315</span>
<span class="co">#&gt; 27 normal        4       21      161        7        1       27        8</span>
<span class="co">#&gt; 30 normal       13      166        5       31       33        5       58</span>
<span class="co">#&gt;    Otu00002 Otu00007 Otu00006</span>
<span class="co">#&gt; 9       995        0      137</span>
<span class="co">#&gt; 14      426       54       40</span>
<span class="co">#&gt; 16       20      590      570</span>
<span class="co">#&gt; 17      357      253      341</span>
<span class="co">#&gt; 27       25      322        5</span>
<span class="co">#&gt; 30      179        6       30</span></code></pre></div>
<p><code>performance</code> is a dataframe of (mainly) performance metrics (1 column for cross-validation performance metric, several for test performance metrics, and 2 columns at the end with ML method and seed):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span><span class="op">$</span><span class="va">performance</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 17</span></span>
<span class="co">#&gt;   cv_metric_AUC logLoss   AUC prAUC Accuracy Kappa    F1 Sensitivity Specificity</span>
<span class="co">#&gt;           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         0.622   0.684 0.647 0.606    0.590 0.179   0.6         0.6       0.579</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 8 more variables: Pos_Pred_Value &lt;dbl&gt;, Neg_Pred_Value &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   Precision &lt;dbl&gt;, Recall &lt;dbl&gt;, Detection_Rate &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   Balanced_Accuracy &lt;dbl&gt;, method &lt;chr&gt;, seed &lt;dbl&gt;</span></span></code></pre></div>
<p>When using logistic regression for binary classification, area under the receiver-operator characteristic curve (AUC) is a useful metric to evaluate model performance. Because of that, it’s the default that we use for <code>mikropml</code>. However, it is crucial to evaluate your model performance using multiple metrics. Below you can find more information about other performance metrics and how to use them in our package.</p>
<p><code>cv_metric_AUC</code> is the AUC for the cross-validation folds for the training data. This gives us a sense of how well the model performs on the training data.</p>
<p>Most of the other columns are performance metrics for the test data — the data that wasn’t used to build the model. Here, you can see that the AUC for the test data is not much above 0.5, suggesting that this model does not predict much better than chance, and that the model is overfit because the cross-validation AUC (<code>cv_metric_AUC</code>, measured during training) is much higher than the testing AUC. This isn’t too surprising since we’re using so few features with this example dataset, so don’t be discouraged. The default option also provides a number of other performance metrics that you might be interested in, including area under the precision-recall curve (prAUC).</p>
<p>The last columns of <code>results$performance</code> are the method and seed (if you set one) to help with combining results from multiple runs (see <code><a href="../articles/parallel.html">vignette("parallel")</a></code>).</p>
<p><code>feature_importance</code> has information about feature importance values if <code>find_feature_importance = TRUE</code> (the default is <code>FALSE</code>). Since we used the defaults, there’s nothing here:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span><span class="op">$</span><span class="va">feature_importance</span>
<span class="co">#&gt; [1] "Skipped feature importance"</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="customizing-parameters">Customizing parameters<a class="anchor" aria-label="anchor" href="#customizing-parameters"></a>
</h2>
<p>There are a few arguments that allow you to change how you execute <code><a href="../reference/run_ml.html">run_ml()</a></code>. We’ve chosen reasonable defaults for you, but we encourage you to change these if you think something else would be better for your data.</p>
<div class="section level3">
<h3 id="changing-kfold-cv_times-and-training_frac">Changing <code>kfold</code>, <code>cv_times</code>, and <code>training_frac</code><a class="anchor" aria-label="anchor" href="#changing-kfold-cv_times-and-training_frac"></a>
</h3>
<ul>
<li>
<code>kfold</code>: The number of folds to run for cross-validation (default: 5).</li>
<li>
<code>cv_times</code>: The number of times to run repeated cross-validation (default: 100).</li>
<li>
<code>training_frac</code>: The fraction of data for the training set (default: 0.8). The rest of the data is used for testing.</li>
</ul>
<p>Here’s an example where we change some of the default parameters:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                         <span class="st">'glmnet'</span>,
                         kfold <span class="op">=</span> <span class="fl">2</span>,
                         cv_times <span class="op">=</span> <span class="fl">5</span>,
                         training_frac <span class="op">=</span> <span class="fl">0.5</span>,
                         seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span>
<span class="co">#&gt; Using 'dx' as the outcome column.</span>
<span class="co">#&gt; Training the model...</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="co">#&gt; Warning in (function (w) : `caret::train()` issued the following warning:</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; simpleWarning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, : There were missing values in resampled performance measures.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; This warning usually means that the model didn't converge in some cross-validation folds because it is predicting something close to a constant. As a result, certain performance metrics can't be calculated. This suggests that some of the hyperparameters chosen are doing very poorly.</span>
<span class="co">#&gt; Training complete.</span></code></pre></div>
<p>You might have noticed that this one ran faster — that’s because we reduced <code>kfold</code> and <code>cv_times</code>. This is okay for testing things out and may even be necessary for smaller datasets. But in general it may be better to have larger numbers for these parameters; we think the defaults are a good starting point <span class="citation">(Topçuoğlu et al. 2020)</span>.</p>
<div class="section level4">
<h4 id="custom-training-indices">Custom training indices<a class="anchor" aria-label="anchor" href="#custom-training-indices"></a>
</h4>
<p>When <code>training_frac</code> is a fraction between 0 and 1, a random sample of observations in the dataset are chosen for the training set to satisfy the <code>training_frac</code>. However, in some cases you might wish to control exactly which observations are in the training set. You can instead assign <code>training_frac</code> a vector of indices that correspond to which rows of the dataset should go in the training set (all remaining sequences will go in the testing set).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="va">otu_mini_bin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">training_size</span> <span class="op">&lt;-</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">n_obs</span>
<span class="va">training_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="va">training_size</span><span class="op">)</span>
<span class="va">results_custom_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                               <span class="st">'glmnet'</span>,
                               kfold <span class="op">=</span> <span class="fl">2</span>,
                               cv_times <span class="op">=</span> <span class="fl">5</span>,
                               training_frac <span class="op">=</span> <span class="va">training_rows</span>,
                               seed <span class="op">=</span> <span class="fl">2019</span>
                               <span class="op">)</span>
<span class="co">#&gt; Using 'dx' as the outcome column.</span>
<span class="co">#&gt; Using the custom training set indices provided by `training_frac`.</span>
<span class="co">#&gt;       The fraction of data in the training set will be 0.8</span>
<span class="co">#&gt; Training the model...</span>
<span class="co">#&gt; Training complete.</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="changing-the-performance-metric">Changing the performance metric<a class="anchor" aria-label="anchor" href="#changing-the-performance-metric"></a>
</h3>
<p>There are two arguments that allow you to change what performance metric to use for model evaluation, and what performance metrics to calculate using the test data.</p>
<p><code>perf_metric_function</code> is the function used to calculate the performance metrics.</p>
<p>The default for classification is <code><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">caret::multiClassSummary()</a></code> and the default for regression is <code><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">caret::defaultSummary()</a></code>. We’d suggest not changing this unless you really know what you’re doing.</p>
<p><code>perf_metric_name</code> is the column name from the output of <code>perf_metric_function</code>. We chose reasonable defaults (AUC for binary, logLoss for multiclass, and RMSE for continuous), but the default functions calculate a bunch of different performance metrics, so you can choose a different one if you’d like.</p>
<p>The default performance metrics available for classification are:</p>
<pre><code><span class="co">#&gt;  [1] "logLoss"                "AUC"                    "prAUC"                 </span>
<span class="co">#&gt;  [4] "Accuracy"               "Kappa"                  "Mean_F1"               </span>
<span class="co">#&gt;  [7] "Mean_Sensitivity"       "Mean_Specificity"       "Mean_Pos_Pred_Value"   </span>
<span class="co">#&gt; [10] "Mean_Neg_Pred_Value"    "Mean_Precision"         "Mean_Recall"           </span>
<span class="co">#&gt; [13] "Mean_Detection_Rate"    "Mean_Balanced_Accuracy"</span></code></pre>
<p>The default performance metrics available for regression are:</p>
<pre><code><span class="co">#&gt; [1] "RMSE"     "Rsquared" "MAE"</span></code></pre>
<p>Here’s an example using prAUC instead of AUC:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>, 
                     <span class="st">'glmnet'</span>, 
                     cv_times <span class="op">=</span> <span class="fl">5</span>, 
                     perf_metric_name <span class="op">=</span> <span class="st">'prAUC'</span>, 
                     seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span>
<span class="co">#&gt; Using 'dx' as the outcome column.</span>
<span class="co">#&gt; Training the model...</span>
<span class="co">#&gt; Warning in (function (w) : `caret::train()` issued the following warning:</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; simpleWarning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, : There were missing values in resampled performance measures.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; This warning usually means that the model didn't converge in some cross-validation folds because it is predicting something close to a constant. As a result, certain performance metrics can't be calculated. This suggests that some of the hyperparameters chosen are doing very poorly.</span>
<span class="co">#&gt; Training complete.</span></code></pre></div>
<p>You’ll see that the cross-validation metric is prAUC, instead of the default AUC:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_pr</span><span class="op">$</span><span class="va">performance</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 17</span></span>
<span class="co">#&gt;   cv_metric_prAUC logLoss   AUC prAUC Accuracy  Kappa    F1 Sensitivity</span>
<span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>           0.577   0.691 0.663 0.605    0.538 0.053<span style="text-decoration: underline;">9</span> 0.690           1</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 9 more variables: Specificity &lt;dbl&gt;, Pos_Pred_Value &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   Neg_Pred_Value &lt;dbl&gt;, Precision &lt;dbl&gt;, Recall &lt;dbl&gt;, Detection_Rate &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   Balanced_Accuracy &lt;dbl&gt;, method &lt;chr&gt;, seed &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-groups">Using groups<a class="anchor" aria-label="anchor" href="#using-groups"></a>
</h3>
<p>The optional <code>groups</code> is a vector of groups to keep together when splitting the data into train and test sets and for cross-validation. Sometimes it’s important to split up the data based on a grouping instead of just randomly. This allows you to control for similarities within groups that you don’t want to skew your predictions (i.e. batch effects). For example, with biological data you may have samples collected from multiple hospitals, and you might like to keep observations from the same hospital in the same partition.</p>
<p>Here’s an example where we split the data into train/test sets based on groups:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make random groups</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span>
<span class="va">grps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">otu_mini_bin</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">results_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>, 
                      <span class="st">'glmnet'</span>, 
                      cv_times <span class="op">=</span> <span class="fl">2</span>, 
                      training_frac <span class="op">=</span> <span class="fl">0.8</span>, 
                      groups <span class="op">=</span> <span class="va">grps</span>, 
                      seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span>
<span class="co">#&gt; Using 'dx' as the outcome column.</span>
<span class="co">#&gt; Fraction of data in the training set: 0.795 </span>
<span class="co">#&gt;  Groups in the training set: A B D F G H </span>
<span class="co">#&gt;  Groups in the testing set: C E</span>
<span class="co">#&gt; Groups will be kept together in CV partitions</span>
<span class="co">#&gt; Training the model...</span>
<span class="co">#&gt; Training complete.</span></code></pre></div>
<p>The one difference here is <code><a href="../reference/run_ml.html">run_ml()</a></code> will report how much of the data is in the training set if you run the above code chunk. This can be a little finicky depending on how many samples and groups you have. This is because it won’t be exactly what you specify with <code>training_frac</code>, since you have to include all of one group in either the training set <em>or</em> the test set.</p>
<div class="section level4">
<h4 id="controling-how-groups-are-assigned-to-partitions">Controling how groups are assigned to partitions<a class="anchor" aria-label="anchor" href="#controling-how-groups-are-assigned-to-partitions"></a>
</h4>
<p>When you use the <code>groups</code> parameter as above, by default <code><a href="../reference/run_ml.html">run_ml()</a></code> will assume that you want all of the observations from each group to be placed in the same partition of the train/test split. This makes sense when you want to use groups to control for batch effects. However, in some cases you might prefer to control exactly which groups end up in which partition, and you might even be okay with some observations from the same group being assigned to different partitions.</p>
<p>For example, say you want groups A and B to be used for training, C and D for testing, and you don’t have a preference for what happens to the other groups. You can give the <code>group_partitions</code> parameter a named list to specify which groups should go in the training set and which should go in the testing set.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_grp_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>, 
                      <span class="st">'glmnet'</span>, 
                      cv_times <span class="op">=</span> <span class="fl">2</span>, 
                      training_frac <span class="op">=</span> <span class="fl">0.8</span>, 
                      groups <span class="op">=</span> <span class="va">grps</span>, 
                      group_partitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>train <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'B'</span><span class="op">)</span>,
                                              test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'C'</span>, <span class="st">'D'</span><span class="op">)</span>
                                              <span class="op">)</span>,
                      seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span>
<span class="co">#&gt; Using 'dx' as the outcome column.</span>
<span class="co">#&gt; Fraction of data in the training set: 0.785 </span>
<span class="co">#&gt;  Groups in the training set: A B E F G H </span>
<span class="co">#&gt;  Groups in the testing set: C D</span>
<span class="co">#&gt; Groups will not be kept together in CV partitions because the number of groups in the training set is not larger than `kfold`</span>
<span class="co">#&gt; Training the model...</span>
<span class="co">#&gt; Training complete.</span></code></pre></div>
<p>In the above case, all observations from A &amp; B will be used for training, all from C &amp; D will be used for testing, and the remaining groups will be randomly assigned to one or the other to satisfy the <code>training_frac</code> as closely as possible.</p>
<p>In another scenario, maybe you want only groups A through F to be used for training, but you also want to allow other observations not selected for training from A through F to be used for testing:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_grp_trainA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>, 
                      <span class="st">'glmnet'</span>, 
                      cv_times <span class="op">=</span> <span class="fl">2</span>, 
                      kfold <span class="op">=</span> <span class="fl">2</span>,
                      training_frac <span class="op">=</span> <span class="fl">0.5</span>, 
                      groups <span class="op">=</span> <span class="va">grps</span>, 
                      group_partitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>train <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span>,
                                              test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span><span class="op">)</span>
                                              <span class="op">)</span>,
                      seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span>
<span class="co">#&gt; Using 'dx' as the outcome column.</span>
<span class="co">#&gt; Fraction of data in the training set: 0.5 </span>
<span class="co">#&gt;  Groups in the training set: A B C D E F </span>
<span class="co">#&gt;  Groups in the testing set: A B C D E F G H</span>
<span class="co">#&gt; Groups will be kept together in CV partitions</span>
<span class="co">#&gt; Training the model...</span>
<span class="co">#&gt; Training complete.</span></code></pre></div>
<p>If you need even more control than this, take a look at <a href="#custom-training-indices">setting custom training indices</a>. You might also prefer to provide your own train control scheme with the <code>cross_val</code> parameter in <code><a href="../reference/run_ml.html">run_ml()</a></code>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="finding-feature-importance">Finding feature importance<a class="anchor" aria-label="anchor" href="#finding-feature-importance"></a>
</h2>
<p>To find which features are contributing to predictive power, you can use <code>find_feature_importance = TRUE</code>. How we use permutation importance to determine feature importance is described in <span class="citation">(Topçuoğlu et al. 2020)</span>. Briefly, it permutes each of the features individually (or correlated ones together) and evaluates how much the performance metric decreases. The more performance decreases when the feature is randomly shuffled, the more important that feature is. The default is <code>FALSE</code> because it takes a while to run and is only useful if you want to know what features are important in predicting your outcome.</p>
<p>Let’s look at some feature importance results:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
  <span class="st">"rf"</span>,
  outcome_colname <span class="op">=</span> <span class="st">"dx"</span>,
  find_feature_importance <span class="op">=</span> <span class="cn">TRUE</span>,
  seed <span class="op">=</span> <span class="fl">2019</span>
<span class="op">)</span></code></pre></div>
<p>Now, we can check out the feature importances:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_imp</span><span class="op">$</span><span class="va">feature_importance</span>
<span class="co">#&gt;    perf_metric perf_metric_diff pvalue    names method perf_metric_name seed</span>
<span class="co">#&gt; 1    0.5542375        0.0082625   0.37 Otu00001     rf              AUC 2019</span>
<span class="co">#&gt; 2    0.5731750       -0.0106750   0.57 Otu00002     rf              AUC 2019</span>
<span class="co">#&gt; 3    0.5548750        0.0076250   0.38 Otu00003     rf              AUC 2019</span>
<span class="co">#&gt; 4    0.6414750       -0.0789750   0.99 Otu00004     rf              AUC 2019</span>
<span class="co">#&gt; 5    0.5049625        0.0575375   0.05 Otu00005     rf              AUC 2019</span>
<span class="co">#&gt; 6    0.5444500        0.0180500   0.18 Otu00006     rf              AUC 2019</span>
<span class="co">#&gt; 7    0.5417125        0.0207875   0.21 Otu00007     rf              AUC 2019</span>
<span class="co">#&gt; 8    0.5257750        0.0367250   0.05 Otu00008     rf              AUC 2019</span>
<span class="co">#&gt; 9    0.5395750        0.0229250   0.02 Otu00009     rf              AUC 2019</span>
<span class="co">#&gt; 10   0.4977625        0.0647375   0.05 Otu00010     rf              AUC 2019</span></code></pre></div>
<p>There are several columns:</p>
<ol style="list-style-type: decimal">
<li>
<code>perf_metric</code>: The performance value of the permuted feature.</li>
<li>
<code>perf_metric_diff</code>: The difference between the performance for the actual and permuted data (i.e. test performance minus permuted performance). Features with a larger <code>perf_metric_diff</code> are more important.</li>
<li>
<code>pvalue</code>: the probability of obtaining the actual performance value under the null hypothesis.</li>
<li>
<code>names</code>: The feature that was permuted.</li>
<li>
<code>method</code>: The ML method used.</li>
<li>
<code>perf_metric_name</code>: The peformance metric used.</li>
<li>
<code>seed</code>: The seed (if set).</li>
</ol>
<p>As you can see here, the differences are negligible (close to zero), which makes sense since our model isn’t great. If you’re interested in feature importance, it’s especially useful to run multiple different train/test splits, as shown in our <a href="https://github.com/SchlossLab/mikropml-snakemake-workflow/" class="external-link">example snakemake workflow</a>.</p>
<p>You can also choose to permute correlated features together using <code>corr_thresh</code> (default: 1). Any features that are above the correlation threshold are permuted together; i.e. perfectly correlated features are permuted together when using the default value.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_imp_corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                           <span class="st">'glmnet'</span>,
                           cv_times <span class="op">=</span> <span class="fl">5</span>,
                           find_feature_importance <span class="op">=</span> <span class="cn">TRUE</span>,
                           corr_thresh <span class="op">=</span> <span class="fl">0.2</span>,
                           seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span>
<span class="co">#&gt; Using 'dx' as the outcome column.</span>
<span class="co">#&gt; Training the model...</span>
<span class="co">#&gt; Warning in (function (w) : `caret::train()` issued the following warning:</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; simpleWarning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, : There were missing values in resampled performance measures.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; This warning usually means that the model didn't converge in some cross-validation folds because it is predicting something close to a constant. As a result, certain performance metrics can't be calculated. This suggests that some of the hyperparameters chosen are doing very poorly.</span>
<span class="co">#&gt; Training complete.</span>
<span class="co">#&gt; Finding feature importance...</span>
<span class="co">#&gt; Feature importance complete.</span>
<span class="va">results_imp_corr</span><span class="op">$</span><span class="va">feature_importance</span>
<span class="co">#&gt;   perf_metric perf_metric_diff pvalue</span>
<span class="co">#&gt; 1   0.5502105       0.09715789   0.08</span>
<span class="co">#&gt; 2   0.6369474       0.01042105   0.40</span>
<span class="co">#&gt; 3   0.5951316       0.05223684   0.08</span>
<span class="co">#&gt;                                                                     names</span>
<span class="co">#&gt; 1 Otu00001|Otu00002|Otu00003|Otu00005|Otu00006|Otu00007|Otu00009|Otu00010</span>
<span class="co">#&gt; 2                                                                Otu00004</span>
<span class="co">#&gt; 3                                                                Otu00008</span>
<span class="co">#&gt;   method perf_metric_name seed</span>
<span class="co">#&gt; 1 glmnet              AUC 2019</span>
<span class="co">#&gt; 2 glmnet              AUC 2019</span>
<span class="co">#&gt; 3 glmnet              AUC 2019</span></code></pre></div>
<p>You can see which features were permuted together in the <code>names</code> column. Here all 3 features were permuted together (which doesn’t really make sense, but it’s just an example).</p>
<p>If you previously executed <code><a href="../reference/run_ml.html">run_ml()</a></code> without feature importance but now wish to find feature importance after the fact, see the example code in the <code><a href="../reference/get_feature_importance.html">get_feature_importance()</a></code> documentation.</p>
<p><code><a href="../reference/get_feature_importance.html">get_feature_importance()</a></code> can show a live progress bar, see <code><a href="../articles/parallel.html">vignette("parallel")</a></code> for examples.</p>
</div>
<div class="section level2">
<h2 id="tuning-hyperparameters-using-the-hyperparameter-argument">Tuning hyperparameters (using the <code>hyperparameter</code> argument)<a class="anchor" aria-label="anchor" href="#tuning-hyperparameters-using-the-hyperparameter-argument"></a>
</h2>
<p>This is important, so we have a whole vignette about them. The bottom line is we provide default hyperparameters that you can start with, but it’s important to tune your hyperparameters. For more information about what the default hyperparameters are, and how to tune hyperparameters, see <code><a href="../articles/tuning.html">vignette("tuning")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="other-models">Other models<a class="anchor" aria-label="anchor" href="#other-models"></a>
</h2>
<p>Here are examples of how to train and evaluate other models. The output for all of them is very similar, so we won’t go into those details.</p>
<div class="section level3">
<h3 id="random-forest">Random forest<a class="anchor" aria-label="anchor" href="#random-forest"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                     <span class="st">'rf'</span>,
                     cv_times <span class="op">=</span> <span class="fl">5</span>,
                     seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span></code></pre></div>
<p>You can also change the number of trees to use for random forest (<code>ntree</code>; default: 1000). This can’t be tuned using <code>rf</code> package implementation of random forest. Please refer to <code>caret</code> documentation if you are interested in other packages with random forest implementations.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_rf_nt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                        <span class="st">'rf'</span>,
                        cv_times <span class="op">=</span> <span class="fl">5</span>,
                        ntree <span class="op">=</span> <span class="fl">10</span>,
                        seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="decision-tree">Decision tree<a class="anchor" aria-label="anchor" href="#decision-tree"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                     <span class="st">'rpart2'</span>,
                     cv_times <span class="op">=</span> <span class="fl">5</span>,
                     seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="svm">SVM<a class="anchor" aria-label="anchor" href="#svm"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span>,
                      <span class="st">'svmRadial'</span>,
                      cv_times <span class="op">=</span> <span class="fl">5</span>,
                      seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span></code></pre></div>
<p>If you get a message “maximum number of iterations reached”, see <a href="https://github.com/topepo/caret/issues/425" class="external-link">this issue</a> in caret.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-data">Other data<a class="anchor" aria-label="anchor" href="#other-data"></a>
</h2>
<div class="section level3">
<h3 id="multiclass-data">Multiclass data<a class="anchor" aria-label="anchor" href="#multiclass-data"></a>
</h3>
<p>We provide <code>otu_mini_multi</code> with a multiclass outcome (three or more outcomes):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">otu_mini_multi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">'dx'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "adenoma"   "carcinoma" "normal"</span></code></pre></div>
<p>Here’s an example of running multiclass data:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_multi</span>,
                        outcome_colname <span class="op">=</span> <span class="st">"dx"</span>,
                        seed <span class="op">=</span> <span class="fl">2019</span>
<span class="op">)</span></code></pre></div>
<p>The performance metrics are slightly different, but the format of everything else is the same:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_multi</span><span class="op">$</span><span class="va">performance</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 17</span></span>
<span class="co">#&gt;   cv_metric_logLoss logLoss   AUC prAUC Accuracy  Kappa Mean_F1 Mean_Sensitivity</span>
<span class="co">#&gt;               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>              1.07    1.11 0.506 0.353    0.382 0.044<span style="text-decoration: underline;">9</span> <span style="color: #BB0000;">NA</span>                 0.360</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 9 more variables: Mean_Specificity &lt;dbl&gt;, Mean_Pos_Pred_Value &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   Mean_Neg_Pred_Value &lt;dbl&gt;, Mean_Precision &lt;chr&gt;, Mean_Recall &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   Mean_Detection_Rate &lt;dbl&gt;, Mean_Balanced_Accuracy &lt;dbl&gt;, method &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   seed &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="continuous-data">Continuous data<a class="anchor" aria-label="anchor" href="#continuous-data"></a>
</h3>
<p>And here’s an example for running continuous data, where the outcome column is numerical:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_cont</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_mini_bin</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span>,
                       <span class="st">'glmnet'</span>,
                       outcome_colname <span class="op">=</span> <span class="st">'Otu00001'</span>,
                       seed <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span></code></pre></div>
<p>Again, the performance metrics are slightly different, but the format of the rest is the same:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_cont</span><span class="op">$</span><span class="va">performance</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span>
<span class="co">#&gt;   cv_metric_RMSE  RMSE Rsquared   MAE method  seed</span>
<span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>           622.  731.   0.089<span style="text-decoration: underline;">3</span>  472. glmnet  <span style="text-decoration: underline;">2</span>019</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-tang_democratizing_2020">
<p>Tang, Shengpu, Parmida Davarmanesh, Yanmeng Song, Danai Koutra, Michael W. Sjoding, and Jenna Wiens. 2020. “Democratizing EHR Analyses with FIDDLE: A Flexible Data-Driven Preprocessing Pipeline for Structured Clinical Data.” <em>J Am Med Inform Assoc</em>, October. <a href="https://doi.org/10.1093/jamia/ocaa139" class="external-link">https://doi.org/10.1093/jamia/ocaa139</a>.</p>
</div>
<div id="ref-topcuoglu_framework_2020">
<p>Topçuoğlu, Begüm D., Nicholas A. Lesniak, Mack T. Ruffin, Jenna Wiens, and Patrick D. Schloss. 2020. “A Framework for Effective Application of Machine Learning to Microbiome-Based Classification Problems.” <em>mBio</em> 11 (3). <a href="https://doi.org/10.1128/mBio.00434-20" class="external-link">https://doi.org/10.1128/mBio.00434-20</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/BTopcuoglu" class="external-link">Begüm Topçuoğlu</a>, <a href="https://github.com/zenalapp" class="external-link">Zena Lapp</a>, <a href="https://github.com/kelly-sovacool" class="external-link">Kelly Sovacool</a>, Evan Snitkin, Jenna Wiens, <a href="https://github.com/pschloss" class="external-link">Patrick Schloss</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
