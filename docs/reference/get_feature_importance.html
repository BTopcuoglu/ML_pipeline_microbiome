<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Get feature importance using the permutation method — get_feature_importance • mikropml</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Get feature importance using the permutation method — get_feature_importance"><meta property="og:description" content="Calculates feature importance using a trained model and test data. Requires
the future.apply package."><meta property="og:image" content="http://www.schlosslab.org/mikropml/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mikropml</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="divider">
    <li class="dropdown-header">Paper</li>
    <li>
      <a href="../articles/paper.html">mikropml: User-Friendly R Package for Supervised Machine Learning Pipelines</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Vignettes</li>
    <li>
      <a href="../articles/introduction.html">Introduction to mikropml</a>
    </li>
    <li>
      <a href="../articles/preprocess.html">Preprocessing data</a>
    </li>
    <li>
      <a href="../articles/tuning.html">Hyperparameter tuning</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel processing</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/SchlossLab/mikropml/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Get feature importance using the permutation method</h1>
    <small class="dont-index">Source: <a href="https://github.com/SchlossLab/mikropml/blob/HEAD/R/feature_importance.R" class="external-link"><code>R/feature_importance.R</code></a></small>
    <div class="hidden name"><code>get_feature_importance.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculates feature importance using a trained model and test data. Requires
the <code>future.apply</code> package.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">get_feature_importance</span><span class="op">(</span>
  <span class="va">trained_model</span>,
  <span class="va">train_data</span>,
  <span class="va">test_data</span>,
  <span class="va">outcome_colname</span>,
  <span class="va">perf_metric_function</span>,
  <span class="va">perf_metric_name</span>,
  <span class="va">class_probs</span>,
  <span class="va">method</span>,
  seed <span class="op">=</span> <span class="cn">NA</span>,
  corr_thresh <span class="op">=</span> <span class="fl">1</span>,
  groups <span class="op">=</span> <span class="cn">NULL</span>,
  nperms <span class="op">=</span> <span class="fl">100</span>,
  corr_method <span class="op">=</span> <span class="st">"spearman"</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>trained_model</dt>
<dd><p>Trained model from <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code>.</p></dd>
<dt>train_data</dt>
<dd><p>Training data: dataframe of outcome and features.</p></dd>
<dt>test_data</dt>
<dd><p>Held out test data: dataframe of outcome and features.</p></dd>
<dt>outcome_colname</dt>
<dd><p>Column name as a string of the outcome variable
(default <code>NULL</code>; the first column will be chosen automatically).</p></dd>
<dt>perf_metric_function</dt>
<dd><p>Function to calculate the performance metric to
be used for cross-validation and test performance. Some functions are
provided by caret (see <code><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">caret::defaultSummary()</a></code>).
Defaults: binary classification = <code>twoClassSummary</code>,
multi-class classification = <code>multiClassSummary</code>,
regression = <code>defaultSummary</code>.</p></dd>
<dt>perf_metric_name</dt>
<dd><p>The column name from the output of the function
provided to perf_metric_function that is to be used as the performance metric.
Defaults: binary classification = <code>"ROC"</code>,
multi-class classification = <code>"logLoss"</code>,
regression = <code>"RMSE"</code>.</p></dd>
<dt>class_probs</dt>
<dd><p>Whether to use class probabilities (TRUE for categorical outcomes, FALSE for numeric outcomes).</p></dd>
<dt>method</dt>
<dd><p>ML method.
Options: <code>c("glmnet", "rf", "rpart2", "svmRadial", "xgbTree")</code>.</p><ul><li><p>glmnet: linear, logistic, or multiclass regression</p></li>
<li><p>rf: random forest</p></li>
<li><p>rpart2: decision tree</p></li>
<li><p>svmRadial: support vector machine</p></li>
<li><p>xgbTree: xgboost</p></li>
</ul></dd>
<dt>seed</dt>
<dd><p>Random seed (default: <code>NA</code>).
Your results will only be reproducible if you set a seed.</p></dd>
<dt>corr_thresh</dt>
<dd><p>For feature importance, group correlations
above or equal to <code>corr_thresh</code> (range <code>0</code> to <code>1</code>; default: <code>1</code>).</p></dd>
<dt>groups</dt>
<dd><p>Vector of feature names to group together during permutation.
Each element should be a string with feature names separated by a pipe
character (<code>|</code>). If this is <code>NULL</code> (default), correlated features will be
grouped together based on <code>corr_thresh</code>.</p></dd>
<dt>nperms</dt>
<dd><p>number of permutations to perform (default: <code>100</code>).</p></dd>
<dt>corr_method</dt>
<dd><p>correlation method. options or the same as those supported
by <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">stats::cor</a></code>: spearman, pearson, kendall. (default: spearman)</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Data frame with performance metrics for when each feature (or group
of correlated features; <code>names</code>) is permuted (<code>perf_metric</code>), differences
between the actual test performance metric on and the permuted performance
metric (<code>perf_metric_diff</code>; test minus permuted performance), and the
p-value (<code>pvalue</code>: the probability of obtaining the actual performance
value under the null hypothesis). Features with a larger <code>perf_metric_diff</code>are more important. The performance metric name (<code>perf_metric_name</code>) and
seed (<code>seed</code>) are also returned.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>For permutation tests, the p-value is the number of permutation statistics
that are greater than the test statistic, divided by the number of
permutations. In our case, the permutation statistic is the model performance
(e.g. AUROC) after randomizing the order of observations for one feature, and
the test statistic is the actual performance on the test data. By default we
perform 100 permutations per feature; increasing this will increase the
precision of estimating the null distribution, but also increases runtime.
The p-value represents the probability of obtaining the actual performance in
the event that the null hypothesis is true, where the null hypothesis is that
the feature is not important for model performance.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Begüm Topçuoğlu, <a href="mailto:topcuoglu.begum@gmail.com">topcuoglu.begum@gmail.com</a></p>
<p>Zena Lapp, <a href="mailto:zenalapp@umich.edu">zenalapp@umich.edu</a></p>
<p>Kelly Sovacool, <a href="mailto:sovacool@umich.edu">sovacool@umich.edu</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="run_ml.html">run_ml</a></span><span class="op">(</span><span class="va">otu_small</span>, <span class="st">"glmnet"</span>, kfold <span class="op">=</span> <span class="fl">2</span>, cv_times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">trained_model</span><span class="op">$</span><span class="va">trainingData</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"dx"</span></span>
<span class="r-in"><span class="fu">get_feature_importance</span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">trained_model</span>,</span>
<span class="r-in">  <span class="va">results</span><span class="op">$</span><span class="va">trained_model</span><span class="op">$</span><span class="va">trainingData</span>, <span class="va">results</span><span class="op">$</span><span class="va">test_data</span>,</span>
<span class="r-in">  <span class="st">"dx"</span>,</span>
<span class="r-in">  <span class="va">multiClassSummary</span>, <span class="st">"AUC"</span>,</span>
<span class="r-in">  class_probs <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"glmnet"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># optionally, you can group features together with a custom grouping</span></span>
<span class="r-in"><span class="fu">get_feature_importance</span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">trained_model</span>,</span>
<span class="r-in">  <span class="va">results</span><span class="op">$</span><span class="va">trained_model</span><span class="op">$</span><span class="va">trainingData</span>, <span class="va">results</span><span class="op">$</span><span class="va">test_data</span>,</span>
<span class="r-in">  <span class="st">"dx"</span>,</span>
<span class="r-in">  <span class="va">multiClassSummary</span>, <span class="st">"AUC"</span>,</span>
<span class="r-in">  class_probs <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"glmnet"</span>,</span>
<span class="r-in">  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span class="r-in">    <span class="st">"Otu00007"</span>, <span class="st">"Otu00008"</span>, <span class="st">"Otu00009"</span>, <span class="st">"Otu00011"</span>, <span class="st">"Otu00012"</span>,</span>
<span class="r-in">    <span class="st">"Otu00015"</span>, <span class="st">"Otu00016"</span>, <span class="st">"Otu00018"</span>, <span class="st">"Otu00019"</span>, <span class="st">"Otu00020"</span>, <span class="st">"Otu00022"</span>,</span>
<span class="r-in">    <span class="st">"Otu00023"</span>, <span class="st">"Otu00025"</span>, <span class="st">"Otu00028"</span>, <span class="st">"Otu00029"</span>, <span class="st">"Otu00030"</span>, <span class="st">"Otu00035"</span>,</span>
<span class="r-in">    <span class="st">"Otu00036"</span>, <span class="st">"Otu00037"</span>, <span class="st">"Otu00038"</span>, <span class="st">"Otu00039"</span>, <span class="st">"Otu00040"</span>, <span class="st">"Otu00047"</span>,</span>
<span class="r-in">    <span class="st">"Otu00050"</span>, <span class="st">"Otu00052"</span>, <span class="st">"Otu00054"</span>, <span class="st">"Otu00055"</span>, <span class="st">"Otu00056"</span>, <span class="st">"Otu00060"</span>,</span>
<span class="r-in">    <span class="st">"Otu00003|Otu00002|Otu00005|Otu00024|Otu00032|Otu00041|Otu00053"</span>,</span>
<span class="r-in">    <span class="st">"Otu00014|Otu00021|Otu00017|Otu00031|Otu00057"</span>,</span>
<span class="r-in">    <span class="st">"Otu00013|Otu00006"</span>, <span class="st">"Otu00026|Otu00001|Otu00034|Otu00048"</span>,</span>
<span class="r-in">    <span class="st">"Otu00033|Otu00010"</span>,</span>
<span class="r-in">    <span class="st">"Otu00042|Otu00004"</span>, <span class="st">"Otu00043|Otu00027|Otu00049"</span>, <span class="st">"Otu00051|Otu00045"</span>,</span>
<span class="r-in">    <span class="st">"Otu00058|Otu00044"</span>, <span class="st">"Otu00059|Otu00046"</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># the function can show a progress bar if you have the progressr package installed</span></span>
<span class="r-in"><span class="co">## optionally, specify the progress bar format</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handler_progress.html" class="external-link">handler_progress</a></span><span class="op">(</span></span>
<span class="r-in">  format <span class="op">=</span> <span class="st">":message :bar :percent | elapsed: :elapsed | eta: :eta"</span>,</span>
<span class="r-in">  clear <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">  show_after <span class="op">=</span> <span class="fl">0</span></span>
<span class="r-in"><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="co">## tell progressr to always report progress</span></span>
<span class="r-in"><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="co">## run the function and watch the live progress udpates</span></span>
<span class="r-in"><span class="va">feat_imp</span> <span class="op">&lt;-</span> <span class="fu">get_feature_importance</span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">trained_model</span>,</span>
<span class="r-in">  <span class="va">results</span><span class="op">$</span><span class="va">trained_model</span><span class="op">$</span><span class="va">trainingData</span>, <span class="va">results</span><span class="op">$</span><span class="va">test_data</span>,</span>
<span class="r-in">  <span class="st">"dx"</span>,</span>
<span class="r-in">  <span class="va">multiClassSummary</span>, <span class="st">"AUC"</span>,</span>
<span class="r-in">  class_probs <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"glmnet"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># you can specify any correlation method supported by `stats::cor`:</span></span>
<span class="r-in"><span class="va">feat_imp</span> <span class="op">&lt;-</span> <span class="fu">get_feature_importance</span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">trained_model</span>,</span>
<span class="r-in">  <span class="va">results</span><span class="op">$</span><span class="va">trained_model</span><span class="op">$</span><span class="va">trainingData</span>, <span class="va">results</span><span class="op">$</span><span class="va">test_data</span>,</span>
<span class="r-in">  <span class="st">"dx"</span>,</span>
<span class="r-in">  <span class="va">multiClassSummary</span>, <span class="st">"AUC"</span>,</span>
<span class="r-in">  class_probs <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"glmnet"</span>,</span>
<span class="r-in">  corr_method <span class="op">=</span> <span class="st">"pearson"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://github.com/BTopcuoglu" class="external-link">Begüm Topçuoğlu</a>, <a href="https://github.com/zenalapp" class="external-link">Zena Lapp</a>, <a href="https://github.com/kelly-sovacool" class="external-link">Kelly Sovacool</a>, Evan Snitkin, Jenna Wiens, <a href="https://github.com/pschloss" class="external-link">Patrick Schloss</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

